<!DOCTYPE html>
{% load static %}
{% load tz %} 

<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" type="text/css" href="{% static "css/download.css" %}">
</head>

<body>
  <br><br><br>
  <form id="downloadForm" method="post" action="">
    {% csrf_token %}
    <div class="invoice-box">
      <div class="upperreport">
        <table cellpadding="0" cellspacing="0">
          <tr class="top">
            <td colspan="2">
              <table>
                <tr>
                  <td class="title">
                    <h5>Hospital Management</h5>
                  </td>
                  <td>
                    Admit Date: {{report.Admit_date}}<br>
                    Release Date: {{ timezone.now|date:"Y-m-d" }}<br> 
                    Days Spent: {{day}}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr class="information">
            <td colspan="2">
              <table>
                <tr>
                  <td>
                    Patient Name: {{report.username}}<br>
                    Patient Mobile: {{report.phone}}<br>
                    Patient Address: {{report.address}}<br>
                  </td>
                  <td>
                    Doctor Name:<br>
                    {{report.dFname}}<br>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr class="information">
            <td colspan="2">
              <table>
                <tr>
                  <td>
                    Disease and Symptoms:<br>
                    {{report.Problem_pat}}
                  </td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
        <h1 class="reporth1">Laboratory Check</h1>
      </div>
      <div class="underreport">
        <div class="reportleft">
          <table class="table1">
            <tr>
              <th colspan="2">Type of Test</th>
              <th>Result</th>
            </tr>
            <tr>
              <td colspan="2">Cardiovascular</td>
              <td>{{report.cardiovascular }}</td>
            </tr>
            <tr>
              <td colspan="2">Pulmonary</td>
              <td>{{report.Pulmonary}}</td>
              
            </tr>            
            <tr>
              <td colspan="2">Gastroenterology</td>
              <td>{{report.Gastroenterology}}</td>
              
            </tr>
            <tr>
              <td colspan="2">Neurology</td>
              <td>{{report.Neurology}}</td>
              
            </tr>
            <tr>
              <td colspan="2">Musculoskeletal</td>
              <td>{{report.Musculoskeleton}}</td>
              
            </tr>
            <tr>
              <td colspan="2">Genitourinary</td>
              <td>{{report.Gentiourinary}}</td>
              
            </tr>
            <tr>
              <td colspan="2">Oro-Dental</td>
              <td>{{report.Oro}}</td>

              
            </tr>
            <tr>
              <td colspan="2">Deformities/Extremities</td>
              <td>{{report.Extremities}}</td>

              
            </tr>
            <tr>
              <td colspan="2">Hernia</td>
              <td>{{report.Hernia }}</td>

              
            </tr>
            <tr>
              <td colspan="2">Hydrocele</td>
              <td>{{report.Hydrocele }}</td>
              
            </tr>
            <tr>
              <td colspan="2">Varicose Veins</td>
              <td>{{report.Varicose }}</td>
            </tr>
            <tr>
              <td rowspan="2">Eye (vision)</td>
              <td>Left</td>
              <td>{{report.Eyeleft}}</td>
              
            </tr>
            <tr>
              <td>Right</td>
              <td>{{report.Eyeright}}</td>
              
            </tr>
            <tr>
              <td rowspan="2">Ear</td>
              <td>Left</td>
              <td>{{report.Earleft}}</td>
              
            </tr>
            <tr>
              <td>Right</td>
              <td>{{report.Earright}}</td>
              
            </tr>
            <tr>
              <td colspan="2">Other</td>
              <td>{{report.other}}</td>
              
            </tr>
            <tr>
              <td colspan="2">Chest X-ray</td>
              <td>{{report.chestxray}}</td>
              
            </tr>
            <tr>
              <td colspan="2">Clinical Impression</td>
              <td>{{report.impression}}</td>
              
            </tr>
            <tr>
              <td rowspan="4">Urine</td>
              <td>RBC</td>
              <td>{{report.rbc}}</td>
              
            </tr>
            <tr>
              <td>Plus Cell</td>
              <td>{{report.plus}}</td>
              
            </tr>
            <tr>
              <td>Epithelial cell</td>
              <td>{{report.epithelial}}</td>
              
            </tr>
            <tr>
              <td>Pregnancy Test (if Female)</td>
              <td>{{report.pregnancy}}</td>

              
            </tr>
          </table>
        </div>
        <div class="reportright">
          <table class="table2">
            <tr>
              <th>Blood Examination</th>
              <th>Result</th>
              <th>Reference Range</th>
            </tr>
            <tr>
              <td>Total WBC Count</td>
              <td>{{report.wbc}}</td>
              <td>4000-11000</td>
            </tr>
            <tr>
              <td>Neutrophils</td>
              <td>{{report.Neutrophils}}</td>              
              <td>45-74%</td>
            </tr>
            <tr>
              <td>Lymphocytes</td>
              <td>{{report.Lymphocytes}}</td>                            
              <td>25-40%</td>
            </tr>
            <tr>
              <td>Eosinophils</td>
              <td>{{report.Eosinophils}}</td>                            
              <td>1-6%</td>
            </tr>
            <tr>
              <td>Monocytes</td>
              <td>{{report.monocytes}}</td>                            
              <td>0-8%</td>
            </tr>
            <tr>
              <td>Basophils</td>
              <td>{{report.basophils}}</td>                            
              <td>0-3%</td>
            </tr>
            <tr>
              <td>Hemoglobin</td>
              <td>{{report.hemoglobin }}</td>                            
              <td>Male:12-17 gm% <br>Female: 11-14gm%</td>
            </tr>
            <tr>
              <td>Random Blood Sugar</td>
              <td>{{report.sugar}}</td>                            
              <td>80-120mg%</td>
            </tr>
            <tr>
              <td>Urea</td>
              <td>{{report.urea }}</td>                            
              <td>20-45mg%</td>
            </tr>
            <tr>
              <td>Creatinine</td>
              <td>{{report.creatine}}</td>                            
              <td>0.4-1.4 mg%</td>
            </tr>
            <tr>
              <td>Bilirubin (Total/Direct)</td>
              <td>{{report.bilirubin}}</td>                            
              <td>0.4-1 mg%</td>
            </tr>
            <tr>
              <td>SGPT</td>
              <td>{{report.sgpt}}</td>                            
              <td>5-37 u/L</td>
            </tr>
            <tr>
              <td>SGOT</td>
              <td>{{report.scot}}</td>                            
              <td>3-45 U/L</td>
            </tr>
            <tr>
              <td rowspan="5">Serology</td>
              <td>{{report.hiv}}</td>                            
              <td>Anti-HIVS</td>
            </tr>
            <tr>
              <td>{{report.hbsag}}</td>                            
              <td>HBS-Ag</td>
            </tr>
            <tr>
              <td>{{report.vdrl}}</td>                            
              <td>VDRL/RPR</td>
            </tr>
            <tr>
              <td>{{report.tpha}}</td>                            
              <td>TPHA</td>
            </tr>
            <tr>
              <td>{{report.bloodgroup}}</td>                            
              <td>Blood Group</td>
            </tr>
            <tr>
              <td>Malaria Parasite</td>
              <td>{{report.malaria}}</td>                            
              <td></td>
            </tr>
            <tr>
              <td>Micro Filaria</td>
              <td>{{report.filaria}}</td>                            
              <td></td>
            </tr>
          </table>
        </div>
      </div>
      <div class="footerreport">
        <p>.........................................<br>Authorized Signature</p>
        <div>
          <p>This Report is valid for 2 months from the date of Medical Examination</p>
          <br>
          <p class="pmargin"> Format-Recommended by Ministry of Health and Population, Government of Nepal</p>
        </div>
        <br>
        <p>.............................................<br>Physician Signature</p>
      </div>
    </div>
  </form>
  
    
  <div class="download" onclick="downloadPdf()">
    <button type="button">Download</button>
  </div>
  
  <script>
   function downloadPdf() {
      const form = document.getElementById('downloadForm');
      const formData = new FormData(form);

      fetch(form.action, {
          method: 'POST',
          body: formData
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Failed to generate PDF');
          }
          return response.blob();
        })
        .then(blob => {
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'Patients_report.pdf';
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          a.remove();
          
          // Open the downloaded PDF automatically
          window.open(url, '_blank');
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Failed to generate PDF');
        });
    }
  </script>
</body>

</html>
